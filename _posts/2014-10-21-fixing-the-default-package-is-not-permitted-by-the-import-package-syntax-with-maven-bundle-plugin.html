---
layout: post
title: Fixing "The default package '.' is not permitted by the Import-Package syntax."
  with maven-bundle-plugin
date: 2014-10-21 01:05:03.000000000 +10:30
type: post
published: true
status: publish
categories:
- Software Development
tags: []
meta:
  _edit_last: '29818343'
  geo_public: '0'
  _publicize_pending: '1'
  _oembed_eccf0e550904bf7fa8df4e787112647f: "{{unknown}}"
author: Tom Saleeba
---
<h1>Overview</h1>
<p>I found this problem when I was trying to bundle a maven project as an OSGi bundle to use with Tycho. The bundle I was trying to make was effectively a shaded/uber JAR that has all the dependencies inlined inside of the final artifact JAR.</p>
<h1>The cause</h1>
<p>This problem is caused by a Java class file existing in the default/unamed package. It could come from anywhere in the dependency chain, including your own project, but in this case it came from one of my dependencies; JDOM.</p>
<h1>The fix</h1>
<p>A Google for this error message finds lots of mail archive discussions on ways to fix it but none of them allude to the fact that it might be coming from an dependency. It's my hope that this post will link searches for this error message to the fix that is posted here: <a href="https://developer.atlassian.com/display/DOCS/Using+JDOM+in+OSGi" target="_blank">https://developer.atlassian.com/display/DOCS/Using+JDOM+in+OSGi</a></p>
<p>In case that site ever changes or goes down, here's what they posted:</p>
<blockquote>
<h1 id="title-text" class="with-breadcrumbs"><a href="https://developer.atlassian.com/display/DOCS/Using+JDOM+in+OSGi">Using JDOM in OSGi</a></h1>
<div id="action-messages"> <a class="external-link" href="http://www.jdom.org/" rel="nofollow">JDOM</a> is a difficult package to use in <a class="external-link" href="http://www.osgi.org/" rel="nofollow">OSGi</a>, for the following reasons:</div>
<div class="wiki-content">
<ul class="toc-indentation">
<li><a href="https://developer.atlassian.com/display/DOCS/Using+JDOM+in+OSGi?continue=https%3A%2F%2Fdeveloper.atlassian.com%2Fdisplay%2FDOCS%2FUsing%2BJDOM%2Bin%2BOSGi&amp;application=dac#UsingJDOMinOSGi-JDOMhasClassesintheRootPackage">JDOM has Classes in the Root Package</a></li>
<li><a href="https://developer.atlassian.com/display/DOCS/Using+JDOM+in+OSGi?continue=https%3A%2F%2Fdeveloper.atlassian.com%2Fdisplay%2FDOCS%2FUsing%2BJDOM%2Bin%2BOSGi&amp;application=dac#UsingJDOMinOSGi-JDOMImportsaNumberofOptionalPackages">JDOM Imports a Number of Optional Packages</a></li>
</ul>
<h3 id="UsingJDOMinOSGi-JDOMhasClassesintheRootPackage">JDOM has Classes in the Root Package</h3>
<p>For some reason, the author of JDOM decided to break one of the fundamental rules of Java, that is, do not put classes in the root package. JDOM has a class called <code>JDOMAuthor</code> in the root package. If you want to include JDOM in your OSGi bundle, you'll need to remove these classes. In Maven, you can do it like this:</p>
</div>
<p>Additionally, if using the Maven Bundle Plugin, you will need to manually include this library, for example:</p>
<div class="code panel pdl">
<pre>&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;
  &lt;executions&gt;
	...
	&lt;execution&gt;
	  &lt;id&gt;unpack-jdom&lt;/id&gt;
	  &lt;phase&gt;compile&lt;/phase&gt;
	  &lt;goals&gt;
		&lt;goal&gt;unpack&lt;/goal&gt;
	  &lt;/goals&gt;
	  &lt;configuration&gt;
		&lt;artifactItems&gt;
		  &lt;artifactItem&gt;
			&lt;groupId&gt;jdom&lt;/groupId&gt;
			&lt;artifactId&gt;jdom&lt;/artifactId&gt;
			&lt;version&gt;1.0&lt;/version&gt;
			&lt;outputDirectory&gt;
			  ${project.build.directory}/jdom
			&lt;/outputDirectory&gt;
		  &lt;/artifactItem&gt;
		&lt;/artifactItems&gt;
	  &lt;/configuration&gt;
	&lt;/execution&gt;
	...
  &lt;/executions&gt;
&lt;/plugin&gt;
...
&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
  &lt;executions&gt;
	...
	&lt;execution&gt;
	  &lt;!-- Remove classes from the root package and re jar --&gt;
	  &lt;id&gt;fix-jdom&lt;/id&gt;
	  &lt;phase&gt;process-classes&lt;/phase&gt;
	  &lt;goals&gt;
		&lt;goal&gt;run&lt;/goal&gt;
	  &lt;/goals&gt;
	  &lt;configuration&gt;
		&lt;tasks&gt;
		  &lt;delete&gt;
			&lt;fileset dir="${project.build.directory}/jdom" includes="*.class"/&gt;
		  &lt;/delete&gt;
		  &lt;jar destfile="${project.build.directory}/jdom-1.0-fixed.jar"&gt;
			&lt;fileset dir="${project.build.directory}/jdom"/&gt;
		  &lt;/jar&gt;
		&lt;/tasks&gt;
	  &lt;/configuration&gt;
	&lt;/execution&gt;
	...
  &lt;/executions&gt;
&lt;/plugin&gt;
</pre>
</div>
<p>Make sure JDOM is not included in your bundled Maven dependencies. You can usually do this by marking JDOM as 'provided'.</p>
<h3 id="UsingJDOMinOSGi-JDOMImportsaNumberofOptionalPackages">JDOM Imports a Number of Optional Packages</h3>
<p>'Optional' is the default setting for imports, if you do not include an OSGi manifest. But if you are using the Maven Bundle Plugin, the default is 'mandatory'.</p>
<p>Note that if you are not marking all packages as optional imports by default, then you will need to add at least the following to your imports:</p>
<div>
<pre>oracle*;resolution:=optional,org.jaxen*;resolution:=optional</pre>
</div>
</blockquote>
<p>A huge thanks to jproper and <a href="https://developer.atlassian.com/display/~smaddox" target="_blank">Sarah Maddox</a> for posting the fix.</p>
