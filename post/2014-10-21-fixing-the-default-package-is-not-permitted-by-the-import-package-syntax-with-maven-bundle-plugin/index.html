<!DOCTYPE html>

<html lang="en-us">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>TechoTom</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="http://blog.techotom.com/css/main.min.03322cbe6bddfc28e7b17b84bc5446282a510b14b57be3371ba1f68ef1ab9ce8.css"/>

    
    
    

    
    
 
    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-101335262-2', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>
    <body>
        
<nav>
  <header>
    <div class="site-title">
        <a href="/">TechoTom</a>
    </div>  
</header>
  <div class="nav-menu">
  
  <a class="color-link nav-link" href="http://blog.techotom.com/index.xml" target="_blank" rel="noopener" type="application/rss+xml">RSS</a>
</div>
<footer class="footer">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
    
    

    

    

    

    

</div>




	<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
	<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>

	<script src="http://blog.techotom.com/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
</nav>
        <div id="content" class="content-container">
        
<h1 class="post-title">Fixing &#34;The default package &#39;.&#39; is not permitted by the Import-Package syntax.&#34; with maven-bundle-plugin</h1>
    
    <time>October 21, 2014</time>
    
    <div>
        <p>
        <h1 id="overview">Overview</h1>
<p>I found this problem when I was trying to bundle a maven project as an OSGi bundle to use with Tycho. The bundle I was trying to make was effectively a shaded/uber JAR that has all the dependencies inlined inside of the final artifact JAR.</p>
<h1 id="the-cause">The cause</h1>
<p>This problem is caused by a Java class file existing in the default/unamed package. It could come from anywhere in the dependency chain, including your own project, but in this case it came from one of my dependencies; JDOM.</p>
<h1 id="the-fix">The fix</h1>
<p>A Google for this error message finds lots of mail archive discussions on ways to fix it but none of them allude to the fact that it might be coming from an dependency. It&rsquo;s my hope that this post will link searches for this error message to the fix that is posted here:Â <a href="">https://developer.atlassian.com/display/DOCS/Using+JDOM+in+OSGi</a></p>
<p>In case that site ever changes or goes down, here&rsquo;s what they posted:</p>
<blockquote>
<h1 id="using-jdom-in-osgihttpsdeveloperatlassiancomdisplaydocsusingjdominosgi"><a href="https://developer.atlassian.com/display/DOCS/Using+JDOM+in+OSGi">Using JDOM in OSGi</a></h1>
<p><a href="http://www.jdom.org/">JDOM</a> is a difficult package to use in <a href="http://www.osgi.org/">OSGi</a>, for the following reasons:</p>
<ul>
<li><a href="https://developer.atlassian.com/display/DOCS/Using+JDOM+in+OSGi?continue=https%3A%2F%2Fdeveloper.atlassian.com%2Fdisplay%2FDOCS%2FUsing%2BJDOM%2Bin%2BOSGi&amp;application=dac#UsingJDOMinOSGi-JDOMhasClassesintheRootPackage">JDOM has Classes in the Root Package</a></li>
<li><a href="https://developer.atlassian.com/display/DOCS/Using+JDOM+in+OSGi?continue=https%3A%2F%2Fdeveloper.atlassian.com%2Fdisplay%2FDOCS%2FUsing%2BJDOM%2Bin%2BOSGi&amp;application=dac#UsingJDOMinOSGi-JDOMImportsaNumberofOptionalPackages">JDOM Imports a Number of Optional Packages</a></li>
</ul>
<h3 id="jdom-has-classes-in-the-root-package">JDOM has Classes in the Root Package</h3>
<p>For some reason, the author of JDOM decided to break one of the fundamental rules of Java, that is, do not put classes in the root package. JDOM has a class called <code>JDOMAuthor</code> in the root package. If you want to include JDOM in your OSGi bundle, you&rsquo;ll need to remove these classes. In Maven, you can do it like this:</p>
<p>Additionally, if using the Maven Bundle Plugin, you will need to manually include this library, for example:</p>
<pre><code>&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;
  &lt;executions&gt;
	...
	&lt;execution&gt;
	  &lt;id&gt;unpack-jdom&lt;/id&gt;
	  &lt;phase&gt;compile&lt;/phase&gt;
	  &lt;goals&gt;
		&lt;goal&gt;unpack&lt;/goal&gt;
	  &lt;/goals&gt;
	  &lt;configuration&gt;
		&lt;artifactItems&gt;
		  &lt;artifactItem&gt;
			&lt;groupId&gt;jdom&lt;/groupId&gt;
			&lt;artifactId&gt;jdom&lt;/artifactId&gt;
			&lt;version&gt;1.0&lt;/version&gt;
			&lt;outputDirectory&gt;
			  ${project.build.directory}/jdom
			&lt;/outputDirectory&gt;
		  &lt;/artifactItem&gt;
		&lt;/artifactItems&gt;
	  &lt;/configuration&gt;
	&lt;/execution&gt;
	...
  &lt;/executions&gt;
&lt;/plugin&gt;
...
&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
  &lt;executions&gt;
	...
	&lt;execution&gt;
	  &lt;!-- Remove classes from the root package and re jar --&gt;
	  &lt;id&gt;fix-jdom&lt;/id&gt;
	  &lt;phase&gt;process-classes&lt;/phase&gt;
	  &lt;goals&gt;
		&lt;goal&gt;run&lt;/goal&gt;
	  &lt;/goals&gt;
	  &lt;configuration&gt;
		&lt;tasks&gt;
		  &lt;delete&gt;
			&lt;fileset dir=&quot;${project.build.directory}/jdom&quot; includes=&quot;*.class&quot;/&gt;
		  &lt;/delete&gt;
		  &lt;jar destfile=&quot;${project.build.directory}/jdom-1.0-fixed.jar&quot;&gt;
			&lt;fileset dir=&quot;${project.build.directory}/jdom&quot;/&gt;
		  &lt;/jar&gt;
		&lt;/tasks&gt;
	  &lt;/configuration&gt;
	&lt;/execution&gt;
	...
  &lt;/executions&gt;
&lt;/plugin&gt;
</code></pre><p>Make sure JDOM is not included in your bundled Maven dependencies. You can usually do this by marking JDOM as &lsquo;provided&rsquo;.</p>
<h3 id="jdom-imports-a-number-of-optional-packages">JDOM Imports a Number of Optional Packages</h3>
<p>&lsquo;Optional&rsquo; is the default setting for imports, if you do not include an OSGi manifest. But if you are using the Maven Bundle Plugin, the default is &lsquo;mandatory&rsquo;.</p>
<p>Note that if you are not marking all packages as optional imports by default, then you will need to add at least the following to your imports:</p>
<pre><code>oracle*;resolution:=optional,org.jaxen*;resolution:=optional
</code></pre></blockquote>
<p>A huge thanks to jproper and <a href="https://developer.atlassian.com/display/~smaddox">Sarah Maddox</a> for posting the fix.</p>

        </p>
    </div>
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "techotom" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    <div class="page-footer">
        
    </div>


        
        </div>
        <footer class="footer-mobile">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
    
    

    

    

    

    

</div>




	<div class="footer-mobile-links">
		<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
		<span class="divider-bar">|</span>
		<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>
	</div>

	<script src="http://blog.techotom.com/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
    </body>
</html>